<script type="text/template" id="AppStatus">
<table>
	<colgroup>
		<col style="width: 16.666%;">
		<col style="width: 16.666%;">
		<col style="width: 16.666%;">
		<col style="width: 16.666%;">
		<col style="width: 16.666%;">
		<col style="width: 16.666%;">
	</colgroup>
	<thead>
		<tr>
			<th>#</th>
			<th>STATUS</th>
			<th>CPU</th>
			<th>MEMORY</th>
			<th>DISK</th>
			<th>UPTIME</th>
		</tr>
	</thead>
	<tbody></tbody>
</table>
</script>

<script>
(function()
{
	_ee.on('setAppStatus', function(target, app)
	{
		var html = $('#AppStatus').html();
		CF.async({url : '/v2/apps/' + app.item.metadata.guid + '/stats', method : 'GET'}, function(statusData)
		{
			if(statusData)
			{
				$(target).html(html);
				
				var body = '';
				for(var key in statusData)
				{
					var days = Math.floor(statusData[key].stats.uptime / 60 / 60 / 24);
					var remain = ((statusData[key].stats.uptime / 60 / 60 / 24) - days) * 24;
					var hours = Math.floor(remain);
					var min = Math.floor((remain - hours) * 60);
					
					body += '<tr>';
					body += '<td>' + key + '</td>';
					body += '<td>' + statusData[key].state + '</td>';
					body += '<td>' + Math.round(statusData[key].stats.usage.cpu * 100) + '% </td>';
					body += '<td>' + Math.round(statusData[key].stats.usage.mem / 1024 / 1024) + ' MB</td>';
					body += '<td>' + Math.round(statusData[key].stats.usage.disk / 1024 / 1024) + ' MB</td>';
					body += '<td>' + (days > 0 ? days + 'd ' : '') + (hours > 0 ? hours + 'hr ' : '') + (min > 0 ? min + 'min' : '') + '</td>';
					body += '</tr>';
				}
				
				$(target).find('tbody').html(body);
			}
			else
			{
				$(target).html('There are no running instances of this app.');
			}
		}, common_error);
	});
})();
</script>